{"version":3,"file":"index.js","sources":["../dist-src/index.js"],"sourcesContent":["import { initialize as baseInitialize, defaultConfig, formatParams, pendding, filterResponse, filterError, complete, getRequestIdentify, removePending } from '@hupo/core-request-base';\nimport { createError } from '@hupo/core-promise'; // 超时\n\nconst CONFIG = defaultConfig();\nlet base_url = '';\nexport const request = async _config => {\n  if (typeof wx !== 'undefined') {\n    return new Promise((resolve, reject) => {\n      const {\n        options,\n        data = {},\n        params = {},\n        headers = CONFIG.headers,\n        setting = {}\n      } = _config;\n      let config = {\n        method: options.type,\n        url: `${base_url}${options.url}`,\n        header: headers,\n        params,\n        data\n      };\n      config = formatParams(config);\n      const request = wx.request({ ...config,\n        ...setting,\n\n        async success(response) {\n          try {\n            response.config = config;\n            response.status = response.statusCode;\n            await filterError(response);\n            response = filterResponse(response);\n            const data = await complete(response, _config);\n            resolve(data);\n          } catch (error) {\n            const id = getRequestIdentify(config);\n            removePending(id);\n            reject(createError(error));\n          }\n        },\n\n        fail(error) {\n          const id = getRequestIdentify(config);\n          removePending(id);\n          reject(createError(error));\n        }\n\n      });\n      pendding(config, () => request.abort());\n    });\n  }\n};\nexport const initialize = baseUrl => {\n  baseInitialize(baseUrl);\n  base_url = baseUrl;\n};\nexport default request;"],"names":["CONFIG","defaultConfig","base_url","request","_config","wx","Promise","resolve","reject","options","data","params","headers","setting","config","method","type","url","header","formatParams","success","response","status","statusCode","filterError","filterResponse","complete","error","id","getRequestIdentify","removePending","createError","fail","pendding","abort","initialize","baseUrl","baseInitialize"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAGA,MAAMA,MAAM,GAAGC,6BAAa,EAA5B;AACA,IAAIC,QAAQ,GAAG,EAAf;AACA,MAAaC,OAAO,GAAG,MAAMC,OAAN,IAAiB;MAClC,OAAOC,EAAP,KAAc,WAAlB,EAA+B;WACtB,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;YAChC;QACJC,OADI;QAEJC,IAAI,GAAG,EAFH;QAGJC,MAAM,GAAG,EAHL;QAIJC,OAAO,GAAGZ,MAAM,CAACY,OAJb;QAKJC,OAAO,GAAG;UACRT,OANJ;UAOIU,MAAM,GAAG;QACXC,MAAM,EAAEN,OAAO,CAACO,IADL;QAEXC,GAAG,EAAG,GAAEf,QAAS,GAAEO,OAAO,CAACQ,GAAI,EAFpB;QAGXC,MAAM,EAAEN,OAHG;QAIXD,MAJW;QAKXD;OALF;MAOAI,MAAM,GAAGK,4BAAY,CAACL,MAAD,CAArB;YACMX,OAAO,GAAGE,EAAE,CAACF,OAAH,oBAAgBW,MAAhB,MACXD,OADW;cAGRO,OAAN,CAAcC,QAAd,EAAwB;cAClB;YACFA,QAAQ,CAACP,MAAT,GAAkBA,MAAlB;YACAO,QAAQ,CAACC,MAAT,GAAkBD,QAAQ,CAACE,UAA3B;kBACMC,2BAAW,CAACH,QAAD,CAAjB;YACAA,QAAQ,GAAGI,8BAAc,CAACJ,QAAD,CAAzB;kBACMX,IAAI,GAAG,MAAMgB,wBAAQ,CAACL,QAAD,EAAWjB,OAAX,CAA3B;YACAG,OAAO,CAACG,IAAD,CAAP;WANF,CAOE,OAAOiB,KAAP,EAAc;kBACRC,EAAE,GAAGC,kCAAkB,CAACf,MAAD,CAA7B;YACAgB,6BAAa,CAACF,EAAD,CAAb;YACApB,MAAM,CAACuB,uBAAW,CAACJ,KAAD,CAAZ,CAAN;;SAdU;;QAkBdK,IAAI,CAACL,KAAD,EAAQ;gBACJC,EAAE,GAAGC,kCAAkB,CAACf,MAAD,CAA7B;UACAgB,6BAAa,CAACF,EAAD,CAAb;UACApB,MAAM,CAACuB,uBAAW,CAACJ,KAAD,CAAZ,CAAN;;;SArBJ;MAyBAM,wBAAQ,CAACnB,MAAD,EAAS,MAAMX,OAAO,CAAC+B,KAAR,EAAf,CAAR;KAzCK,CAAP;;CAFG;AA+CP,MAAaC,UAAU,GAAGC,OAAO,IAAI;EACnCC,0BAAc,CAACD,OAAD,CAAd;EACAlC,QAAQ,GAAGkC,OAAX;CAFK;;;;;;"}