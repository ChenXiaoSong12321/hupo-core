{"version":3,"file":"index.js","sources":["../dist-src/index.js"],"sourcesContent":["import * as requestUtils from '@hupo/core-request-utils';\nimport { promise } from '@hupo/core-promise';\nimport { global } from '@hupo/core-global';\nconst CONFIG = requestUtils.defaultConfig();\n\nconst toUniConfig = config => {\n  const {\n    options,\n    data = {},\n    params = {},\n    headers = CONFIG.headers,\n    timeout = CONFIG.timeout,\n    setting = {}\n  } = config;\n  const urlParams = requestUtils.formatParams(params);\n  return {\n    url: `${global._request.baseUrl}${options.url}${urlParams}`,\n    data,\n    header: headers,\n    method: options.type.toUpperCase(),\n    timeout,\n    ...setting\n  };\n};\n\nexport const send = async config => {\n  const uniConfig = toUniConfig(config);\n  const task = uni.request(uniConfig);\n  await requestUtils.pendding(config);\n  const [error, res] = await task;\n  requestUtils.removePending(config);\n\n  if (error) {\n    return Promise.reject(promise.createError({\n      message: 'request fail',\n      info: error,\n      response: null\n    }));\n  }\n\n  const response = {\n    config,\n    status: res.statusCode,\n    data: res.data\n  };\n  await requestUtils.filterError(response);\n  requestUtils.filterResponse(response);\n  return requestUtils.complete(response);\n};\nexport const request = {\n  initialize: requestUtils.initialize,\n  send\n};"],"names":["CONFIG","requestUtils","toUniConfig","config","options","data","params","headers","timeout","setting","urlParams","url","global","_request","baseUrl","header","method","type","toUpperCase","send","uniConfig","task","uni","request","error","res","Promise","reject","promise","createError","message","info","response","status","statusCode","initialize"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAGA,MAAMA,MAAM,GAAGC,0BAAA,EAAf;;AAEA,MAAMC,WAAW,GAAGC,MAAM,IAAI;QACtB;IACJC,OADI;IAEJC,IAAI,GAAG,EAFH;IAGJC,MAAM,GAAG,EAHL;IAIJC,OAAO,GAAGP,MAAM,CAACO,OAJb;IAKJC,OAAO,GAAGR,MAAM,CAACQ,OALb;IAMJC,OAAO,GAAG;MACRN,MAPJ;QAQMO,SAAS,GAAGT,yBAAA,CAA0BK,MAA1B,CAAlB;;IAEEK,GAAG,EAAG,GAAEC,iBAAM,CAACC,QAAP,CAAgBC,OAAQ,GAAEV,OAAO,CAACO,GAAI,GAAED,SAAU,EAD5D;IAEEL,IAFF;IAGEU,MAAM,EAAER,OAHV;IAIES,MAAM,EAAEZ,OAAO,CAACa,IAAR,CAAaC,WAAb,EAJV;IAKEV;KACGC,OANL;CAVF;;AAoBA,MAAaU,IAAI,GAAG,MAAMhB,MAAN,IAAgB;QAC5BiB,SAAS,GAAGlB,WAAW,CAACC,MAAD,CAA7B;QACMkB,IAAI,GAAGC,GAAG,CAACC,OAAJ,CAAYH,SAAZ,CAAb;QACMnB,qBAAA,CAAsBE,MAAtB,CAAN;QACM,CAACqB,KAAD,EAAQC,GAAR,IAAe,MAAMJ,IAA3B;EACApB,0BAAA,CAA2BE,MAA3B;;MAEIqB,KAAJ,EAAW;WACFE,OAAO,CAACC,MAAR,CAAeC,mBAAO,CAACC,WAAR,CAAoB;MACxCC,OAAO,EAAE,cAD+B;MAExCC,IAAI,EAAEP,KAFkC;MAGxCQ,QAAQ,EAAE;KAHU,CAAf,CAAP;;;QAOIA,QAAQ,GAAG;IACf7B,MADe;IAEf8B,MAAM,EAAER,GAAG,CAACS,UAFG;IAGf7B,IAAI,EAAEoB,GAAG,CAACpB;GAHZ;QAKMJ,wBAAA,CAAyB+B,QAAzB,CAAN;EACA/B,2BAAA,CAA4B+B,QAA5B;SACO/B,qBAAA,CAAsB+B,QAAtB,CAAP;CAtBK;AAwBP,MAAaT,OAAO,GAAG;EACrBY,UAAU,EAAElC,uBADS;EAErBkB;CAFK;;;;;"}