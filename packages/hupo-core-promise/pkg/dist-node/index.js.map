{"version":3,"file":"index.js","sources":["../dist-src/index.js"],"sourcesContent":["import global from '@hupo/core-global';\nif (!global.promise) global.promise = {};\n\nconst isRegExp = reg => Object.prototype.toString.call(reg) === '[object RegExp]';\n\nexport const createError = data => {\n  if (typeof data === 'string') {\n    return new Error(data);\n  } else if (data instanceof Error) {\n    return data;\n  } else {\n    const message = data.message || data.msg || 'reject';\n    const error = new Error(message);\n    Object.keys(data).forEach(key => {\n      if (key !== 'message') {\n        error[key] = data[key];\n      }\n    });\n    return error;\n  }\n};\nexport const exit = data => {\n  const error = createError(data);\n  return Promise.reject(error);\n};\nexport const cache = async (id, promise) => {\n  if (!global.promise[id]) {\n    global.promise[id] = promise();\n  }\n\n  try {\n    return await global.promise[id];\n  } catch (error) {\n    global.promise[id] = null;\n    delete global.promise[id];\n    return exit(error);\n  }\n};\nexport const del = id => {\n  // 正则匹配\n  if (isRegExp(id)) {\n    Object.keys(global.promise).forEach(key => {\n      if (id.test(key)) {\n        global.promise[key] = null;\n        delete global.promise[key];\n      }\n    });\n  } else if (global.promise[id]) {\n    global.promise[id] = null;\n    delete global.promise[id];\n  }\n};\nexport const delay = time => new Promise(resolve => {\n  setTimeout(resolve, time);\n});\nexport default {\n  createError,\n  exit,\n  cache,\n  del,\n  delay\n};"],"names":["global","promise","isRegExp","reg","Object","prototype","toString","call","createError","data","Error","message","msg","error","keys","forEach","key","exit","Promise","reject","cache","id","del","test","delay","time","resolve","setTimeout"],"mappings":";;;;;;;;AACA,IAAI,CAACA,MAAM,CAACC,OAAZ,EAAqBD,MAAM,CAACC,OAAP,GAAiB,EAAjB;;AAErB,MAAMC,QAAQ,GAAGC,GAAG,IAAIC,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BC,IAA1B,CAA+BJ,GAA/B,MAAwC,iBAAhE;;AAEA,MAAaK,WAAW,GAAGC,IAAI,IAAI;MAC7B,OAAOA,IAAP,KAAgB,QAApB,EAA8B;WACrB,IAAIC,KAAJ,CAAUD,IAAV,CAAP;GADF,MAEO,IAAIA,IAAI,YAAYC,KAApB,EAA2B;WACzBD,IAAP;GADK,MAEA;UACCE,OAAO,GAAGF,IAAI,CAACE,OAAL,IAAgBF,IAAI,CAACG,GAArB,IAA4B,QAA5C;UACMC,KAAK,GAAG,IAAIH,KAAJ,CAAUC,OAAV,CAAd;IACAP,MAAM,CAACU,IAAP,CAAYL,IAAZ,EAAkBM,OAAlB,CAA0BC,GAAG,IAAI;UAC3BA,GAAG,KAAK,SAAZ,EAAuB;QACrBH,KAAK,CAACG,GAAD,CAAL,GAAaP,IAAI,CAACO,GAAD,CAAjB;;KAFJ;WAKOH,KAAP;;CAbG;AAgBP,MAAaI,IAAI,GAAGR,IAAI,IAAI;QACpBI,KAAK,GAAGL,WAAW,CAACC,IAAD,CAAzB;SACOS,OAAO,CAACC,MAAR,CAAeN,KAAf,CAAP;CAFK;AAIP,MAAaO,KAAK,GAAG,OAAOC,EAAP,EAAWpB,OAAX,KAAuB;MACtC,CAACD,MAAM,CAACC,OAAP,CAAeoB,EAAf,CAAL,EAAyB;IACvBrB,MAAM,CAACC,OAAP,CAAeoB,EAAf,IAAqBpB,OAAO,EAA5B;;;MAGE;WACK,MAAMD,MAAM,CAACC,OAAP,CAAeoB,EAAf,CAAb;GADF,CAEE,OAAOR,KAAP,EAAc;IACdb,MAAM,CAACC,OAAP,CAAeoB,EAAf,IAAqB,IAArB;WACOrB,MAAM,CAACC,OAAP,CAAeoB,EAAf,CAAP;WACOJ,IAAI,CAACJ,KAAD,CAAX;;CAVG;AAaP,MAAaS,GAAG,GAAGD,EAAE,IAAI;;MAEnBnB,QAAQ,CAACmB,EAAD,CAAZ,EAAkB;IAChBjB,MAAM,CAACU,IAAP,CAAYd,MAAM,CAACC,OAAnB,EAA4Bc,OAA5B,CAAoCC,GAAG,IAAI;UACrCK,EAAE,CAACE,IAAH,CAAQP,GAAR,CAAJ,EAAkB;QAChBhB,MAAM,CAACC,OAAP,CAAee,GAAf,IAAsB,IAAtB;eACOhB,MAAM,CAACC,OAAP,CAAee,GAAf,CAAP;;KAHJ;GADF,MAOO,IAAIhB,MAAM,CAACC,OAAP,CAAeoB,EAAf,CAAJ,EAAwB;IAC7BrB,MAAM,CAACC,OAAP,CAAeoB,EAAf,IAAqB,IAArB;WACOrB,MAAM,CAACC,OAAP,CAAeoB,EAAf,CAAP;;CAXG;AAcP,MAAaG,KAAK,GAAGC,IAAI,IAAI,IAAIP,OAAJ,CAAYQ,OAAO,IAAI;EAClDC,UAAU,CAACD,OAAD,EAAUD,IAAV,CAAV;CAD2B,CAAtB;AAGP,YAAe;EACbjB,WADa;EAEbS,IAFa;EAGbG,KAHa;EAIbE,GAJa;EAKbE;CALF;;;;;;;;;"}