{"version":3,"file":"index.js","sources":["../dist-src/index.js"],"sourcesContent":["import { global } from '@hupo/core-global';\nif (!global.promise) global.promise = {};\n\nconst isRegExp = reg => Object.prototype.toString.call(reg) === '[object RegExp]';\n\nconst createError = data => {\n  if (typeof data === 'string') {\n    return new Error(data);\n  } else if (data instanceof Error) {\n    return data;\n  } else {\n    const message = data.message || data.msg || 'reject';\n    const error = new Error(message);\n    Object.keys(data).forEach(key => {\n      if (key !== 'message') {\n        error[key] = data[key];\n      }\n    });\n    return error;\n  }\n};\n\nconst exit = data => {\n  const error = createError(data);\n  return Promise.reject(error);\n};\n\nconst cache = async (id, promise) => {\n  if (!global.promise[id]) {\n    global.promise[id] = promise();\n  }\n\n  try {\n    return await global.promise[id];\n  } catch (error) {\n    global.promise[id] = null;\n    delete global.promise[id];\n    return exit(error);\n  }\n};\n\nconst del = id => {\n  // 正则匹配\n  if (isRegExp(id)) {\n    Object.keys(global.promise).forEach(key => {\n      if (id.test(key)) {\n        global.promise[key] = null;\n        delete global.promise[key];\n      }\n    });\n  } else if (global.promise[id]) {\n    global.promise[id] = null;\n    delete global.promise[id];\n  }\n};\n\nconst delay = time => new Promise(resolve => {\n  setTimeout(resolve, time);\n});\n\nexport const promise = {\n  createError,\n  exit,\n  cache,\n  del,\n  delay\n};"],"names":["global","promise","isRegExp","reg","Object","prototype","toString","call","createError","data","Error","message","msg","error","keys","forEach","key","exit","Promise","reject","cache","id","del","test","delay","time","resolve","setTimeout"],"mappings":";;;;;;AACA,IAAI,CAACA,iBAAM,CAACC,OAAZ,EAAqBD,iBAAM,CAACC,OAAP,GAAiB,EAAjB;;AAErB,MAAMC,QAAQ,GAAGC,GAAG,IAAIC,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BC,IAA1B,CAA+BJ,GAA/B,MAAwC,iBAAhE;;AAEA,MAAMK,WAAW,GAAGC,IAAI,IAAI;MACtB,OAAOA,IAAP,KAAgB,QAApB,EAA8B;WACrB,IAAIC,KAAJ,CAAUD,IAAV,CAAP;GADF,MAEO,IAAIA,IAAI,YAAYC,KAApB,EAA2B;WACzBD,IAAP;GADK,MAEA;UACCE,OAAO,GAAGF,IAAI,CAACE,OAAL,IAAgBF,IAAI,CAACG,GAArB,IAA4B,QAA5C;UACMC,KAAK,GAAG,IAAIH,KAAJ,CAAUC,OAAV,CAAd;IACAP,MAAM,CAACU,IAAP,CAAYL,IAAZ,EAAkBM,OAAlB,CAA0BC,GAAG,IAAI;UAC3BA,GAAG,KAAK,SAAZ,EAAuB;QACrBH,KAAK,CAACG,GAAD,CAAL,GAAaP,IAAI,CAACO,GAAD,CAAjB;;KAFJ;WAKOH,KAAP;;CAbJ;;AAiBA,MAAMI,IAAI,GAAGR,IAAI,IAAI;QACbI,KAAK,GAAGL,WAAW,CAACC,IAAD,CAAzB;SACOS,OAAO,CAACC,MAAR,CAAeN,KAAf,CAAP;CAFF;;AAKA,MAAMO,KAAK,GAAG,OAAOC,EAAP,EAAWpB,OAAX,KAAuB;MAC/B,CAACD,iBAAM,CAACC,OAAP,CAAeoB,EAAf,CAAL,EAAyB;IACvBrB,iBAAM,CAACC,OAAP,CAAeoB,EAAf,IAAqBpB,OAAO,EAA5B;;;MAGE;WACK,MAAMD,iBAAM,CAACC,OAAP,CAAeoB,EAAf,CAAb;GADF,CAEE,OAAOR,KAAP,EAAc;IACdb,iBAAM,CAACC,OAAP,CAAeoB,EAAf,IAAqB,IAArB;WACOrB,iBAAM,CAACC,OAAP,CAAeoB,EAAf,CAAP;WACOJ,IAAI,CAACJ,KAAD,CAAX;;CAVJ;;AAcA,MAAMS,GAAG,GAAGD,EAAE,IAAI;;MAEZnB,QAAQ,CAACmB,EAAD,CAAZ,EAAkB;IAChBjB,MAAM,CAACU,IAAP,CAAYd,iBAAM,CAACC,OAAnB,EAA4Bc,OAA5B,CAAoCC,GAAG,IAAI;UACrCK,EAAE,CAACE,IAAH,CAAQP,GAAR,CAAJ,EAAkB;QAChBhB,iBAAM,CAACC,OAAP,CAAee,GAAf,IAAsB,IAAtB;eACOhB,iBAAM,CAACC,OAAP,CAAee,GAAf,CAAP;;KAHJ;GADF,MAOO,IAAIhB,iBAAM,CAACC,OAAP,CAAeoB,EAAf,CAAJ,EAAwB;IAC7BrB,iBAAM,CAACC,OAAP,CAAeoB,EAAf,IAAqB,IAArB;WACOrB,iBAAM,CAACC,OAAP,CAAeoB,EAAf,CAAP;;CAXJ;;AAeA,MAAMG,KAAK,GAAGC,IAAI,IAAI,IAAIP,OAAJ,CAAYQ,OAAO,IAAI;EAC3CC,UAAU,CAACD,OAAD,EAAUD,IAAV,CAAV;CADoB,CAAtB;;AAIA,MAAaxB,OAAO,GAAG;EACrBO,WADqB;EAErBS,IAFqB;EAGrBG,KAHqB;EAIrBE,GAJqB;EAKrBE;CALK;;;;"}