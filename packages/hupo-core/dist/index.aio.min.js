!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("@hupo/core-global"),require("@hupo/core-timer")):"function"==typeof define&&define.amd?define(["exports","@hupo/core-global","@hupo/core-timer"],n):n((e=e||self).core={},e.coreGlobal,e.coreTimer)}(this,function(e,n,t){"use strict";n=n&&n.hasOwnProperty("default")?n.default:n,t=t&&t.hasOwnProperty("default")?t.default:t;var o="undefined"==typeof window?(global.$mall||(global.$mall={}),global.$mall):(window.$mall||(window.$mall={}),window.$mall);function c(e,n,t,o,r,i,a){try{var s=e[i](a),c=s.value}catch(e){return void t(e)}s.done?n(c):Promise.resolve(c).then(o,r)}function r(e){return Promise.reject(new Error(e))}var i={exit:r,cache:function(){var t=function(s){return function(){var e=this,a=arguments;return new Promise(function(n,t){var o=s.apply(e,a);function r(e){c(o,n,t,r,i,"next",e)}function i(e){c(o,n,t,r,i,"throw",e)}r(void 0)})}}(regeneratorRuntime.mark(function e(n,t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o.promise||(o.promise={}),o.promise[n]||(o.promise[n]=t()),e.prev=2,e.next=5,o.promise[n];case 5:return e.abrupt("return",e.sent);case 8:return e.prev=8,e.t0=e.catch(2),o.promise[n]=null,delete o.promise[n],e.abrupt("return",r(e.t0));case 13:case"end":return e.stop()}},e,null,[[2,8]])}));return function(e,n){return t.apply(this,arguments)}}(),del:function(e){o.promise[e]&&(o.promise[e]=null,delete o.promise[e])},delay:function(n){return new Promise(function(e){setTimeout(e,n)})}},a={clearStorage:1,hideToast:1,hideLoading:1,drawCanvas:1,canIUse:1,stopRecord:1,pauseVoice:1,stopVoice:1,pauseBackgroundAudio:1,stopBackgroundAudio:1,showNavigationBarLoading:1,hideNavigationBarLoading:1,createAnimation:1,createSelectorQuery:1,hideKeyboard:1,stopPullDownRefresh:1,createWorker:1,pageScrollTo:1,reportAnalytics:1},s={};function u(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}"undefined"!=typeof wx&&Object.keys(wx).forEach(function(e){a[e]||/^get\w*Manager$/.test(e)||/^create\w*Context$/.test(e)||/^(on|off)/.test(e)||/\w+Sync$/.test(e)?s[e]=function(){return wx[e].apply(wx,arguments)}:s[e]=function(){var i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(n,t){var o=i.success,r=i.fail;i.success=function(e){o&&o.apply(this,arguments),n(e)},i.fail=function(e){console.log(i,e),r&&r.apply(this,arguments),t(e)},wx[e](i)})}}),s.$nextTick=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:500;return new Promise(function(e,n){s.nextTick?s.nextTick(e):setTimeout(function(){e()},t)})};function l(e){return e.__wxWebviewId__||e._uid}function f(e){return e.__cml_originOptions__?e.__cml_originOptions__.componentName:e.$options.componentName}var p=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.initialize()}return function(e,n,t){n&&u(e.prototype,n),t&&u(e,t)}(e,[{key:"initialize",value:function(){this.pages={}}},{key:"addPage",value:function(e){var n=l(e);e._children={},this.pages[n]||(this.pages[n]=e)}},{key:"removePage",value:function(e){var n=l(e);delete this.pages[n]}},{key:"addComponent",value:function(e){var n=f(e);if(n){var t=e.$route?e.$route.matched[0].instances.default:e,o=l(t),r=this.pages[o];r._children[n]||(r._children[n]=[]),r._children[n].push(e),e._page=r}else console.warn("you have to add componentName of component",e)}},{key:"removeComponent",value:function(e){var n=f(e);if(n){var t=l(e._page),o=this.pages[t];o&&o._children[n]&&o._children[n].splice(o._children[n].indexOf(e)>>>0,1)}else console.warn("you have to add componentName of component",e)}}]),e}(),h={created:function(){o._baseTree.addComponent(this)},beforeDestroy:function(){o._baseTree.removeComponent(this)}},d={created:function(){o._baseTree.addPage(this)},beforeDestroy:function(){o._baseTree.removePage(this)}};function v(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}o._baseTree=new p;var m=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.events={}}return function(e,n,t){n&&v(e.prototype,n),t&&v(e,t)}(e,[{key:"on",value:function(e,n){"function"==typeof n?(this.events[e]=this.events[e]||[]).push(n):console.error("callback handler must be a function")}},{key:"emit",value:function(e){if(this.events[e]&&0<this.events[e].length){var n=this.events[e];if(n)for(var t=[].slice.call(arguments,1),o=0,r=n.length;o<r;o++)n[o].apply(null,t)}}},{key:"off",value:function(e,n){if(this.events=this.events||{},arguments.length){var t=this.events[e];t&&(1!==arguments.length?(t.splice(t.indexOf(n)>>>0,1),this.events[e]=t):delete this.events[e])}else this.events={}}}]),e}(),g={created:function(){this._event=new m},beforeDestroy:function(){this._off(),delete this._event},methods:{_getCurrentPageComponents:function(e){return this._page._children[e]||[]},_on:function(){var e;(e=this._event).on.apply(e,arguments)},_off:function(){var e;(e=this._event).off.apply(e,arguments)},_emit:function(){var e;(e=this._event).emit.apply(e,arguments)},_broadcast:function(e){for(var n=arguments.length,t=new Array(1<n?n-1:0),o=1;o<n;o++)t[o-1]=arguments[o];this._getCurrentPageComponents(e).forEach(function(e){var n;(n=e._event).emit.apply(n,t)})}}},_={methods:{_getCurrentPageComponents:function(e){return this._children[e]||[]},_broadcast:function(e){for(var n=arguments.length,t=new Array(1<n?n-1:0),o=1;o<n;o++)t[o-1]=arguments[o];this._getCurrentPageComponents(e).forEach(function(e){var n;(n=e._event).emit.apply(n,t)})}}};e.global=n,e.timer=t,e.Event=m,e.componentBaseTreeMixin=h,e.componentEventMixin=g,e.pageBaseTreeMixin=d,e.pageEventMixin=_,e.promise=i,e.wxTools=s,Object.defineProperty(e,"__esModule",{value:!0})});
