!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r((e=e||self)["core-request-mp"]={})}(this,function(e){"use strict";function s(e,r,t,n,o,a,c){try{var i=e[a](c),s=i.value}catch(e){return void t(e)}i.done?r(s):Promise.resolve(s).then(n,o)}function r(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})),t.push.apply(t,n)}return t}function v(o){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?r(a,!0).forEach(function(e){var r,t,n;r=o,n=a[t=e],t in r?Object.defineProperty(r,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):r[t]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(a)):r(a).forEach(function(e){Object.defineProperty(o,e,Object.getOwnPropertyDescriptor(a,e))})}return o}var _="undefined"==typeof window?(global.$mall||(global.$mall={}),global.$mall):(window.$mall||(window.$mall={}),window.$mall);_.__request_pending__={};function y(e){return encodeURIComponent(JSON.stringify(e))}function w(e){console.groupCollapsed("%cresponse debug: %c".concat(e.config.options.url),"color: #999","color: #0076ff"),console.log(e.config),console.log(e.data),console.groupEnd();var r=y(e.config);return j(r),e.data}function O(e){var r="";switch(e.status){case 400:r="请求错误";break;case 401:r="未授权，请登录";break;case 403:r="拒绝访问";break;case 404:r="请求地址出错: ".concat(e.config.url);break;case 408:r="请求超时";break;case 500:r="服务器内部错误";break;case 501:r="服务未实现";break;case 502:r="网关错误";break;case 503:r="服务不可用";break;case 504:r="网关超时";break;case 505:r="HTTP版本不受支持"}if(200===e.status||r||(r="系统繁忙，请稍后再试"),r)return Promise.reject({message:r,response:e})}function h(e,r){var t=e.code;if(void 0===t)return e;switch(t){case 0:return e.data;case-1:var n={message:"系统错误",info:"".concat(e.msg,": ").concat(r.options.url),data:e};return Promise.reject(n);default:var o={message:e.msg,info:"".concat(e.msg,": ").concat(r.options.url),data:e};return Promise.reject(o)}}var j=function(e,r){var t=1<arguments.length&&void 0!==r&&r;_.__request_pending__[e]&&t&&_.__request_pending__[e]("abort"),delete _.__request_pending__[e]},P={withCredentials:!1,timeout:15e3,headers:{"Content-Type":"application/json;charset=utf-8"}},k="",t=function(){var r=function(i){return function(){var e=this,c=arguments;return new Promise(function(r,t){var n=i.apply(e,c);function o(e){s(n,r,t,o,a,"next",e)}function a(e){s(n,r,t,o,a,"throw",e)}o(void 0)})}}(regeneratorRuntime.mark(function e(m){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!=typeof wx)return e.abrupt("return",new Promise(function(t,r){var n,o,e=m.options,a=m.data,c=void 0===a?{}:a,i=m.params,s=void 0===i?{}:i,u=m.headers,f=void 0===u?P.headers:u,l={method:e.type,url:"".concat(k).concat(e.url),header:f,params:s,data:c};n=l,o={},Object.keys(n.params).forEach(function(e){var r=Object.prototype.toString.call(n.params[e]);r.includes("Array")&&(n.params[e]=n.params[e].join(",")),o[e]=encodeURIComponent(r.includes("Object")?JSON.stringify(n.params[e]):n.params[e])}),n.url=function(e,r){var t=1<arguments.length&&void 0!==r?r:"";for(var n in e)if(-1===t.indexOf(n)){var o=-1<t.indexOf("?")?"&":"?";t=/(\#\/.+)$/g.test(t)?t.replace(/(\#\/.+)$/g,o+"".concat(n,"=").concat(e[n])+"$1"):t+o+"".concat(n,"=").concat(e[n])}return t}(o,n.url),delete n.params,l=n;var p,d,g,b=wx.request(v({},l,{success:function(e){e.config=l,e.status=e.statusCode,e=w(e),O(e);var r=h(e,m);t(r)},fail:function(e){console.error("看看错误数据结构",e),r(e)}}));p=l,d=b.abort,g=y(p),j(g,!0),_.__request_pending__[g]=d}));e.next=2;break;case 2:case"end":return e.stop()}},e)}));return function(e){return r.apply(this,arguments)}}();e.default=t,e.initialize=function(e){!function(e){console.log("baseURL",e),_.__base_url__=e}(e),k=e},e.request=t,Object.defineProperty(e,"__esModule",{value:!0})});
