{"version":3,"file":"index.js","sources":["../dist-src/index.js"],"sourcesContent":["import global from '@hupo/core-global';\nimport { addUrlParam } from '@hupo/core-url';\nimport { createError } from '@hupo/core-promise';\nglobal.__request_pending__ = {};\nexport const initialize = baseUrl => {\n  console.log('baseURL', baseUrl);\n  global.__base_url__ = baseUrl;\n}; // 默认配置\n\nexport const defaultConfig = () => {\n  return {\n    withCredentials: false,\n    // send cookies when cross-domain requests\n    timeout: 15000,\n    // request timeout\n    headers: {\n      'Content-Type': 'application/json;charset=utf-8'\n    }\n  };\n}; // 格式化get 参数\n\nexport const formatParams = config => {\n  const params = {};\n  Object.keys(config.params).forEach(key => {\n    const type = Object.prototype.toString.call(config.params[key]);\n\n    if (type.includes('Array')) {\n      config.params[key] = config.params[key].join(',');\n    }\n\n    params[key] = encodeURIComponent(type.includes('Object') ? JSON.stringify(config.params[key]) : config.params[key]);\n  });\n  config.url = addUrlParam(params, config.url);\n  delete config.params;\n  return config;\n}; // 获取请求唯一id// 获取请求唯一id\n\nexport const getRequestIdentify = config => {\n  config.url = config.url.replace(config.baseURL, '');\n  config.data = typeof config.data === 'string' ? JSON.parse(config.data) : config.data;\n  return encodeURIComponent(JSON.stringify({\n    url: config.url,\n    data: config.data,\n    method: config.method\n  }));\n}; // 缓存正在请求的接口\n\nexport const pendding = (config, abort) => {\n  const id = getRequestIdentify(config);\n  removePending(id, true);\n  global.__request_pending__[id] = abort;\n}; // 结束正在请求的接口\n\nexport const removePending = (key, isRequest = false) => {\n  if (global.__request_pending__[key] && isRequest) {\n    global.__request_pending__[key]('abort');\n  }\n\n  delete global.__request_pending__[key];\n}; // 请求完成处理\n\nexport const filterResponse = response => {\n  console.groupCollapsed(`%cresponse debug: %c${response.config.url}`, 'color: #999', 'color: #0076ff');\n  console.log(response.config);\n  console.log(response.data);\n  console.groupEnd();\n  const id = getRequestIdentify(response.config);\n  removePending(id);\n  return response;\n}; // 通用异常处理\n\nexport const filterError = response => new Promise((resolve, reject) => {\n  let message = '';\n\n  switch (response.status) {\n    case 400:\n      message = '请求错误';\n      break;\n\n    case 401:\n      message = '未授权，请登录';\n      break;\n\n    case 403:\n      message = '拒绝访问';\n      break;\n\n    case 404:\n      message = `请求地址出错: ${response.config.url}`;\n      break;\n\n    case 408:\n      message = '请求超时';\n      break;\n\n    case 500:\n      message = '服务器内部错误';\n      break;\n\n    case 501:\n      message = '服务未实现';\n      break;\n\n    case 502:\n      message = '网关错误';\n      break;\n\n    case 503:\n      message = '服务不可用';\n      break;\n\n    case 504:\n      message = '网关超时';\n      break;\n\n    case 505:\n      message = 'HTTP版本不受支持';\n      break;\n\n    default:\n      break;\n  }\n\n  if (response.status !== 200 && !message) {\n    message = '系统繁忙，请稍后再试';\n  }\n\n  if (message) {\n    reject(createError({\n      message,\n      response\n    }));\n  } else {\n    resolve();\n  }\n});\nexport const complete = (response, config) => new Promise((resolve, reject) => {\n  const {\n    data = {}\n  } = response;\n  const {\n    code\n  } = data;\n\n  if (code === undefined) {\n    // 如果没有 code 代表这不是业务接口 比如获取配置\n    resolve(data);\n  } else {\n    // 有 code 代表这是一个后端接口 可以进行进一步的判断\n    switch (code) {\n      case 0:\n        // [ 示例 ] code === 0 代表没有错误\n        resolve(data.data);\n        break;\n\n      case -1:\n        {\n          const error = {\n            message: '系统错误',\n            info: `${data.msg}: ${config.options.url}`,\n            data: response\n          };\n          reject(createError(error));\n          break;\n        }\n\n      default:\n        {\n          const defaultError = {\n            message: data.msg,\n            info: `${data.msg}: ${config.options.url}`,\n            data: response\n          };\n          reject(createError(defaultError));\n          break;\n        }\n    }\n  }\n});"],"names":["global","__request_pending__","initialize","baseUrl","console","log","__base_url__","defaultConfig","withCredentials","timeout","headers","formatParams","config","params","Object","keys","forEach","key","type","prototype","toString","call","includes","join","encodeURIComponent","JSON","stringify","url","addUrlParam","getRequestIdentify","replace","baseURL","data","parse","method","pendding","abort","id","removePending","isRequest","filterResponse","response","groupCollapsed","groupEnd","filterError","Promise","resolve","reject","message","status","createError","complete","code","undefined","error","info","msg","options","defaultError"],"mappings":"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"}