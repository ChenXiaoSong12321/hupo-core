{"version":3,"file":"index.js","sources":["../dist-src/index.js"],"sourcesContent":["import global from '@hupo/core-global';\nimport { addUrlParam } from '@hupo/core-url';\nglobal.__request_pending__ = {};\nexport const initialize = baseUrl => {\n  console.log('baseURL', baseUrl);\n  global.__base_url__ = baseUrl;\n}; // 默认配置\n\nexport const defaultConfig = () => {\n  return {\n    withCredentials: false,\n    // send cookies when cross-domain requests\n    timeout: 15000,\n    // request timeout\n    headers: {\n      'Content-Type': 'application/json;charset=utf-8'\n    }\n  };\n}; // 格式化get 参数\n\nexport const formatParams = config => {\n  const params = {};\n  Object.keys(config.params).forEach(key => {\n    const type = Object.prototype.toString.call(config.params[key]);\n\n    if (type.includes('Array')) {\n      config.params[key] = config.params[key].join(',');\n    }\n\n    params[key] = encodeURIComponent(type.includes('Object') ? JSON.stringify(config.params[key]) : config.params[key]);\n  });\n  config.url = addUrlParam(params, config.url);\n  delete config.params;\n  return config;\n}; // 获取请求唯一id\n\nexport const getRequestIdentify = config => encodeURIComponent(JSON.stringify(config)); // 缓存正在请求的接口\n\nexport const pendding = (config, abort) => {\n  const id = getRequestIdentify(config);\n  removePending(id, true);\n  global.__request_pending__[id] = abort;\n}; // 结束正在请求的接口\n\nexport const removePending = (key, isRequest = false) => {\n  if (global.__request_pending__[key] && isRequest) {\n    global.__request_pending__[key]('abort');\n  }\n\n  delete global.__request_pending__[key];\n}; // 请求完成处理\n\nexport const filterResponse = response => {\n  console.groupCollapsed(`%cresponse debug: %c${response.config.url}`, 'color: #999', 'color: #0076ff');\n  console.log(response.config);\n  console.log(response.data);\n  console.groupEnd();\n  const id = getRequestIdentify(response.config);\n  removePending(id);\n  return response.data;\n}; // 通用异常处理\n\nexport const filterError = response => {\n  let message = '';\n\n  switch (response.status) {\n    case 400:\n      message = '请求错误';\n      break;\n\n    case 401:\n      message = '未授权，请登录';\n      break;\n\n    case 403:\n      message = '拒绝访问';\n      break;\n\n    case 404:\n      message = `请求地址出错: ${response.config.url}`;\n      break;\n\n    case 408:\n      message = '请求超时';\n      break;\n\n    case 500:\n      message = '服务器内部错误';\n      break;\n\n    case 501:\n      message = '服务未实现';\n      break;\n\n    case 502:\n      message = '网关错误';\n      break;\n\n    case 503:\n      message = '服务不可用';\n      break;\n\n    case 504:\n      message = '网关超时';\n      break;\n\n    case 505:\n      message = 'HTTP版本不受支持';\n      break;\n\n    default:\n      break;\n  }\n\n  if (response.status !== 200 && !message) {\n    message = '系统繁忙，请稍后再试';\n  }\n\n  if (message) {\n    return Promise.reject({\n      message,\n      response\n    });\n  }\n};\nexport const complete = (responseData, config) => {\n  const {\n    code\n  } = responseData;\n\n  if (code === undefined) {\n    // 如果没有 code 代表这不是业务接口 比如获取配置\n    return responseData;\n  } else {\n    // 有 code 代表这是一个后端接口 可以进行进一步的判断\n    switch (code) {\n      case 0:\n        // [ 示例 ] code === 0 代表没有错误\n        return responseData.data;\n\n      case -1:\n        {\n          const error = {\n            message: '系统错误',\n            info: `${responseData.msg}: ${config.options.url}`,\n            data: responseData\n          };\n          return Promise.reject(error);\n        }\n\n      default:\n        {\n          const defaultError = {\n            message: responseData.msg,\n            info: `${responseData.msg}: ${config.options.url}`,\n            data: responseData\n          };\n          return Promise.reject(defaultError);\n        }\n    }\n  }\n};"],"names":["global","__request_pending__","initialize","baseUrl","console","log","__base_url__","defaultConfig","withCredentials","timeout","headers","formatParams","config","params","Object","keys","forEach","key","type","prototype","toString","call","includes","join","encodeURIComponent","JSON","stringify","url","addUrlParam","getRequestIdentify","pendding","abort","id","removePending","isRequest","filterResponse","response","groupCollapsed","data","groupEnd","filterError","message","status","Promise","reject","complete","responseData","code","undefined","error","info","msg","options","defaultError"],"mappings":"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"}