{"version":3,"file":"index.js","sources":["../dist-src/Event.js","../dist-src/mixins/component.js","../dist-src/mixins/page.js","../dist-src/index.js"],"sourcesContent":["// event.js\nexport default class Event {\n  constructor() {\n    this.events = {};\n    this.stores = {};\n  }\n\n  on(event, handler) {\n    if (typeof handler != 'function') {\n      console.error('callback handler must be a function');\n      return;\n    }\n\n    (this.events[event] = this.events[event] || []).push(handler);\n\n    if (this.stores[event]) {\n      handler(...this.stores[event]);\n    }\n  }\n\n  emit(event) {\n    if (this.events[event] && this.events[event].length > 0) {\n      const events = this.events[event];\n\n      if (events) {\n        const args = [].slice.call(arguments, 1);\n\n        for (let i = 0, len = events.length; i < len; i++) {\n          events[i].apply(null, args);\n        }\n      }\n    }\n  }\n\n  emitCache(event, ...args) {\n    if (args.length) {\n      this.stores[event] = args;\n      this.emit(event, ...args);\n    }\n  }\n\n  off(event, handler) {\n    this.events = this.events || {}; // all\n\n    if (!arguments.length) {\n      this.events = {};\n      this.stores = {};\n      return;\n    }\n\n    if (arguments.length === 1 && this.stores[event]) {\n      delete this.stores[event];\n    }\n\n    const events = this.events[event];\n    if (!events) return; // remove all handlers\n\n    if (arguments.length === 1) {\n      delete this.events[event];\n      return;\n    } // remove specific handler\n\n\n    events.splice(events.indexOf(handler) >>> 0, 1);\n    this.events[event] = events;\n    return;\n  }\n\n}","import Event from '../Event.js';\nimport global from '@hupo/core-global';\n\nconst getViewId = instance => instance._uid ? instance._uid : instance.__wxWebviewId__ || instance.getPageId();\n\nexport default {\n  beforeDestroy() {\n    this._off();\n\n    delete this._event;\n  },\n\n  methods: {\n    _getCurrentPageComponents(componentName) {\n      const viewId = getViewId(this);\n      const page = global._baseTree.pages[viewId];\n      return page && page._children ? page._children[componentName] : [];\n    },\n\n    _on(event, handler) {\n      if (!this._event) this._event = new Event();\n\n      this._event.on(event, handler);\n    },\n\n    _off(...arg) {\n      this._event && this._event.off(...arg);\n    },\n\n    _emit(...arg) {\n      this._event && this._event.emit(...arg);\n    },\n\n    _emitCache(...arg) {\n      this._event && this._event.emitCache(...arg);\n    },\n\n    _broadcast(componentName, ...arg) {\n      const components = this._getCurrentPageComponents(componentName);\n\n      components.forEach(item => {\n        item._event.emit(...arg);\n      });\n    }\n\n  }\n};","import Event from '../Event.js';\nexport default {\n  beforeDestroy() {\n    this._off();\n\n    delete this._event;\n  },\n\n  methods: {\n    _getCurrentPageComponents(componentName) {\n      return this._children[componentName] || [];\n    },\n\n    _on(event, handler) {\n      if (!this._event) this._event = new Event();\n\n      this._event.on(event, handler);\n    },\n\n    _off(...arg) {\n      this._event && this._event.off(...arg);\n    },\n\n    _emit(...arg) {\n      this._event && this._event.emit(...arg);\n    },\n\n    _emitCache(...arg) {\n      this._event && this._event.emitCache(...arg);\n    },\n\n    _broadcast(componentName, ...args) {\n      const components = this._getCurrentPageComponents(componentName);\n\n      components.forEach(item => {\n        item._event.emit(...args);\n      });\n    }\n\n  }\n};","import global from '@hupo/core-global';\nimport Event from \"./Event.js\";\nglobal._eventbus = new Event();\nexport { default as componentEventMixin } from \"./mixins/component.js\";\nexport { default as pageEventMixin } from \"./mixins/page.js\";\nexport { Event };"],"names":["Event","constructor","events","stores","on","event","handler","console","error","push","emit","length","args","slice","call","arguments","i","len","apply","emitCache","off","splice","indexOf","getViewId","instance","_uid","__wxWebviewId__","getPageId","beforeDestroy","_off","_event","methods","_getCurrentPageComponents","componentName","viewId","page","global","_baseTree","pages","_children","_on","arg","_emit","_emitCache","_broadcast","components","forEach","item","_eventbus"],"mappings":"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"}